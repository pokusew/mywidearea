/*! mywidearea 2014-06-27 20:21:07 */
var MyWidearea=function(a){a&&(a.scheme&&(this.scheme=a.scheme),a.iconActivate&&(this.iconActivate=a.iconActivate),a.iconClose&&(this.iconClose=a.iconClose),a.iconClose&&(this.iconClose=a.iconClose)),this.initialize()};MyWidearea.prototype={scheme:"light",iconClose:'<i class="fa fa-times"></i>',iconActivate:'<i class="fa fa-arrows-alt"></i>',iconContrast:'<i class="fa fa-adjust"></i>',textareas:{},iconsWrapper:null,overlay:null,state:0,recalculator:null,fullscreen:!1,initialize:function(){console.log("MyWidearea: initializing");var a=this;this.overlay=$(document.createElement("div")),this.overlay.addClass("mywidearea-overlay"),this.overlay.addClass("hidden"),this.overlay.addClass(this.scheme),this.overlay.appendTo("body");var b=$(document.createElement("div"));b.addClass("mywidearea-control-wrapper");var c=$(document.createElement("a"));c.html(this.iconClose),c.attr("href","#"),c.appendTo(b),c.click(function(b){b.preventDefault(),a.fullscreenOff()});var d=$(document.createElement("a"));d.html(this.iconContrast),d.attr("href","#"),d.appendTo(b),d.click(function(b){b.preventDefault(),a.toogleScheme()}),b.appendTo(this.overlay),this.iconsWrapper=$(document.createElement("div")),this.iconsWrapper.addClass("mywidearea-icons-wrapper"),this.iconsWrapper.appendTo("body"),$(document).on("keyup",function(b){27===b.keyCode&&a.fullscreenOff()})},enable:function(){console.log("MyWidearea: enabling"),1===this.state&&(console.log("MyWidearea: cleaning"),clearInterval(this.recalculator),this.textareas={},this.state=0,this.overlay.find("textarea").remove(),this.iconsWrapper.html(""),this.fullscreen=!1);var a=this;$('textarea[data-mywidearea="true"]').each(function(b,c){var d=$(c);d.attr("data-mywidearea-id",b),a.textareas[b]=d,a.addIcon(b)}),this.calculateIconsPosition(),this.recalculator=setInterval(function(){a.calculateIconsPosition()},200),this.state=1},addIcon:function(a){var b=$(document.createElement("div"));b.addClass("mywidearea-icon-wrapper"),b.addClass("hidden"),b.attr("data-mywidearea-id",a);var c=$(document.createElement("a"));c.html(this.iconActivate),c.attr("href","#"),c.appendTo(b);var d=this;c.click(function(a){a.preventDefault();var b=$(this).parents(".mywidearea-icon-wrapper").attr("data-mywidearea-id");d.fullscreenOn(b)}),b.appendTo(this.iconsWrapper)},calculateIconsPosition:function(){for(i in this.textareas){var a=i,b=this.textareas[i],c=$('.mywidearea-icon-wrapper[data-mywidearea-id="'+a+'"]');if("none"!==b.css("display")){var d=b.offset(),e=b.outerWidth();d={top:Math.round(d.top),left:Math.round(d.left)};var f={top:d.top+5,left:d.left+e-25};c.removeClass("hidden"),c.css({top:f.top+"px",left:f.left+"px"})}else c.addClass("hidden")}},toogleScheme:function(){console.log("MyWidearea: toogling scheme"),"light"===this.scheme?(this.overlay.removeClass("light"),this.overlay.addClass("dark"),this.scheme="dark"):"dark"===this.scheme&&(this.overlay.removeClass("dark"),this.overlay.addClass("light"),this.scheme="light")},fullscreenOn:function(a){console.log("MyWidearea: turning fullscreen ON for textarea "+a);var b=this.textareas[a],c=$(document.createElement("textarea"));c.attr("placeholder",b.attr("placeholder")),c.attr("data-mywidearea-id",a),c.val(b.val()),c.appendTo(this.overlay),this.fullscreen=!0,this.overlay.removeClass("hidden"),c.focus()},fullscreenOff:function(){if(this.fullscreen){console.log("MyWidearea: turning fullscreen OFF");var a=this.overlay.find("textarea"),b=this.textareas[a.attr("data-mywidearea-id")];b.val(a.val()),this.fullscreen=!1,this.overlay.addClass("hidden"),a.remove()}}};